<Window x:Class="BIMQuantityManager.Views.TypeQuantitySummaryView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="BIM Quantity Manager"
        Width="1300"
        Height="680"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/BIMQuantityManager;component/Templates/MainWindowResource.xaml"/>
                <ResourceDictionary Source="/BIMQuantityManager;component/Templates/ScrollBarStyleResource.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Dark Theme (Default) -->
            <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#1E1E1E"/>
            <SolidColorBrush x:Key="CardBrush" Color="#2E2E2E"/>
            <SolidColorBrush x:Key="SurfaceBrush" Color="#F5F5F5"/>
            <SolidColorBrush x:Key="BorderBrush" Color="#555555"/>
            <SolidColorBrush x:Key="TextPrimaryBrush" Color="White"/>
            <SolidColorBrush x:Key="DataGridRowBrush" Color="#2E2E2E"/>
            <SolidColorBrush x:Key="DataGridAlternateBrush" Color="#333333"/>
            <SolidColorBrush x:Key="GridLineBrush" Color="#555555"/>
            <SolidColorBrush x:Key="DataGridLineBrush" Color="White"/>

            <!-- Modern Context Menu Brushes -->
            <SolidColorBrush x:Key="MenuBackgroundBrush" Color="#2D2D30"/>
            <SolidColorBrush x:Key="MenuBorderBrush" Color="#3F3F46"/>
            <SolidColorBrush x:Key="MenuItemHoverBrush" Color="#3E3E42"/>
            <SolidColorBrush x:Key="MenuItemPressedBrush" Color="#007ACC"/>
            <SolidColorBrush x:Key="MenuSeparatorBrush" Color="#3F3F46"/>

            <!-- Header -->
            <Style x:Key="HeaderStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="18"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
            </Style>

            <!-- Logo Image Style -->
            <Style x:Key="LogoImageStyle" TargetType="Image">
                <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality"/>
                <Setter Property="Opacity" Value="1"/>
            </Style>

            <!-- ComboBox dropdown theme brushes -->
            <SolidColorBrush x:Key="ComboBackgroundBrush" Color="#2E2E2E"/>
            <SolidColorBrush x:Key="ComboForegroundBrush" Color="#FFFFFF"/>
            <SolidColorBrush x:Key="ComboBorderBrush" Color="#555555"/>
            <SolidColorBrush x:Key="ComboItemHoverBrush" Color="#3A3A3A"/>
            <SolidColorBrush x:Key="ComboItemSelectedBrush" Color="#007ACC"/>

            <!-- OVERRIDE ComboBox Popup Style -->
            <Style x:Key="CustomComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource ModernComboBox}">
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Grid>
                                <ToggleButton x:Name="ToggleButton"
                                            Grid.Column="2"
                                            Focusable="false"
                                            IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                            ClickMode="Press"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="1">
                                    <ToggleButton.Style>
                                        <Style TargetType="ToggleButton">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ToggleButton">
                                                        <Border x:Name="Border"
                                                                Background="{TemplateBinding Background}"
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                                CornerRadius="4">
                                                            <ContentPresenter/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="Transparent"/>
                                                                <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ToggleButton.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition Width="20"/>
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter Grid.Column="0"
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Center"
                                                        Margin="8,0,0,0"
                                                        Content="{TemplateBinding SelectionBoxItem}"
                                                        ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                        ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                        TextElement.Foreground="{TemplateBinding Foreground}"/>
                                        <Path Grid.Column="1"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Data="M 0 0 L 4 4 L 8 0 Z"
                                            Fill="{TemplateBinding Foreground}"/>
                                    </Grid>
                                </ToggleButton>
                                <Popup x:Name="Popup"
                                    Placement="Bottom"
                                    IsOpen="{TemplateBinding IsDropDownOpen}"
                                    AllowsTransparency="True"
                                    Focusable="False"
                                    PopupAnimation="Slide">
                                    <Grid x:Name="DropDown"
                                        SnapsToDevicePixels="True"
                                        MinWidth="{TemplateBinding ActualWidth}"
                                        MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                        <Border x:Name="DropDownBorder"
                                                Background="{DynamicResource ComboBackgroundBrush}"
                                                BorderBrush="{DynamicResource ComboBorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Margin="0,2,0,0">
                                            <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                                <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                            </ScrollViewer>
                                        </Border>
                                    </Grid>
                                </Popup>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- OVERRIDE ComboBox Item Style -->
            <Style x:Key="CustomComboBoxItem" TargetType="ComboBoxItem">
                <Setter Property="SnapsToDevicePixels" Value="true"/>
                <Setter Property="Padding" Value="8,6"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource ComboForegroundBrush}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBoxItem">
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="true">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsHighlighted" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ComboItemHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ComboItemSelectedBrush}"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 🎨 MODERN CONTEXT MENU STYLE -->
            <Style x:Key="ModernContextMenuStyle" TargetType="ContextMenu">
                <Setter Property="Background" Value="{DynamicResource MenuBackgroundBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource MenuBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="0,4"/>
                <Setter Property="HasDropShadow" Value="True"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContextMenu">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8"
                                    Padding="{TemplateBinding Padding}">
                                <Border.Effect>
                                    <DropShadowEffect Color="Black" 
                                                    Opacity="0.3" 
                                                    BlurRadius="20" 
                                                    ShadowDepth="4"
                                                    Direction="270"/>
                                </Border.Effect>
                                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                            HorizontalScrollBarVisibility="Disabled">
                                    <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                </ScrollViewer>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 🎨 MODERN MENU ITEM STYLE -->
            <Style x:Key="ModernMenuItemStyle" TargetType="MenuItem">
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="FontFamily" Value="Segoe UI"/>
                <Setter Property="Height" Value="36"/>
                <Setter Property="Padding" Value="12,0"/>
                <Setter Property="Margin" Value="4,2"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="MenuItem">
                            <Border x:Name="Border"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    CornerRadius="6"
                                    Padding="{TemplateBinding Padding}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="28"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon -->
                                    <ContentPresenter Grid.Column="0"
                                                    ContentSource="Icon"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Margin="0,0,8,0"/>

                                    <!-- Text -->
                                    <TextBlock Grid.Column="1"
                                             Text="{TemplateBinding Header}"
                                             VerticalAlignment="Center"
                                             Foreground="{TemplateBinding Foreground}"/>

                                    <!-- Submenu Arrow -->
                                    <Path Grid.Column="2"
                                          x:Name="SubMenuArrow"
                                          Data="M 0 0 L 4 4 L 0 8 Z"
                                          Fill="{TemplateBinding Foreground}"
                                          Margin="8,0,0,0"
                                          VerticalAlignment="Center"
                                          Visibility="Collapsed"/>

                                    <!-- Submenu Popup -->
                                    <Popup x:Name="PART_Popup"
                                           AllowsTransparency="True"
                                           Placement="Right"
                                           HorizontalOffset="19"
                                           VerticalOffset="-6"
                                           IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                           Focusable="False"
                                           PopupAnimation="Slide">
                                        <Border Background="{DynamicResource MenuBackgroundBrush}"
                                                BorderBrush="{DynamicResource MenuBorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="0,4">
                                            <Border.Effect>
                                                <DropShadowEffect Color="Black" 
                                                                Opacity="0.3" 
                                                                BlurRadius="20" 
                                                                ShadowDepth="4"
                                                                Direction="270"/>
                                            </Border.Effect>
                                            <ScrollViewer VerticalScrollBarVisibility="Auto"
                                                        HorizontalScrollBarVisibility="Disabled">
                                                <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Cycle"
                                                              Margin="0"/>
                                            </ScrollViewer>
                                        </Border>
                                    </Popup>
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsHighlighted" Value="True">
                                    <Setter TargetName="Border" Property="Background" 
                                            Value="{DynamicResource MenuItemHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="Border" Property="Background" 
                                            Value="{DynamicResource MenuItemPressedBrush}"/>
                                </Trigger>
                                <DataTrigger Binding="{Binding HasItems, RelativeSource={RelativeSource Self}}" Value="True">
                                    <Setter TargetName="SubMenuArrow" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 🎨 MENU SEPARATOR STYLE -->
            <Style x:Key="ModernSeparatorStyle" TargetType="Separator">
                <Setter Property="Height" Value="1"/>
                <Setter Property="Margin" Value="8,2"/>
                <Setter Property="Background" Value="{DynamicResource MenuSeparatorBrush}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Separator">
                            <Border Background="{TemplateBinding Background}"
                                    Height="{TemplateBinding Height}"
                                    Margin="{TemplateBinding Margin}"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid x:Name="MainGrid" Background="{DynamicResource WindowBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Border Grid.Row="0" Background="{DynamicResource CardBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo -->
                <Image Grid.Column="0"
               x:Name="LogoImage"
               Source="pack://application:,,,/BIMQuantityManager;component/Logo/logo.png"
               Width="55" Height="55"
               VerticalAlignment="Center"
               Margin="0,0,16,0"
               Stretch="Uniform"
               Style="{StaticResource LogoImageStyle}"/>

                <!-- Başlık -->
                <TextBlock Grid.Column="1"
                   Text="BIM Quantity Manager"
                   Style="{StaticResource HeaderStyle}"
                   FontSize="24"
                   VerticalAlignment="Center"/>

                <Button Grid.Column="2"
                     x:Name="SettingsButton"
                     Style="{StaticResource ModernButton}"
                     Width="50"
                     Height="50"
                     HorizontalAlignment="Right"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"
                     Click="SettingsButton_Click"
                     Cursor="Hand"
                     Background="Transparent"
                     BorderThickness="0"
                     Padding="0">
                    <Button.Content>
                        <Grid Width="50" Height="50">
                            <!-- Dark Mode Settings Icon -->
                            <Image x:Name="SettingsIconDark"
                                 Source="pack://application:,,,/BIMQuantityManager;component/Icons/WhiteList.png"
                                 Width="30"
                                 Height="30"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center"
                                 Opacity="1"/>

                            <!-- Light Mode Settings Icon -->
                            <Image x:Name="SettingsIconLight"
                               Source="pack://application:,,,/BIMQuantityManager;component/Icons/BlackList.png"
                               Width="30"
                               Height="30"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Opacity="0"/>
                        </Grid>
                    </Button.Content>

                    <!-- 🎨 SETTINGS CONTEXT MENU -->
                    <Button.ContextMenu>
                        <ContextMenu x:Name="SettingsContextMenu"
                           Style="{StaticResource ModernContextMenuStyle}"
                           Placement="Bottom"
                           PlacementTarget="{Binding ElementName=SettingsButton}"
                           VerticalOffset="2"
                           MinWidth="220">

                            <!-- 🌙 THEME TOGGLE MENU ITEM -->
                            <MenuItem x:Name="ThemeMenuItem"
                                   Header="Switch to Light Mode"
                                   Click="ThemeMenuItem_Click"
                                   Style="{StaticResource ModernMenuItemStyle}">
                                <MenuItem.Icon>
                                    <Grid Width="24" Height="24">
                                        <!-- Dark Mode'da gösterilecek: 2.png -->
                                        <Image x:Name="ThemeIconDark"
                                           Source="pack://application:,,,/BIMQuantityManager;component/Icons/2.png"
                                           Width="23" Height="23"
                                           Stretch="Uniform"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           Visibility="Visible"/>
                                        <!-- Light Mode'da gösterilecek: 1.png -->
                                        <Image x:Name="ThemeIconLight"
                                           Source="pack://application:,,,/BIMQuantityManager;component/Icons/1.png"
                                           Width="23" Height="23"
                                           Stretch="Uniform"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           Visibility="Collapsed"/>
                                    </Grid>
                                </MenuItem.Icon>
                            </MenuItem>
                            
                            <!-- ✅ SEPARATOR -->
                            <Separator Style="{StaticResource ModernSeparatorStyle}"/>

                            <!-- 🌍 LANGUAGE SUBMENU -->
                            <MenuItem x:Name="LanguageMenuItem"
                                  Header="Language"
                                  Style="{StaticResource ModernMenuItemStyle}">
                                <MenuItem.Icon>
                                    <Grid Width="21" Height="21">
                                        <!-- Dark Mode'da gösterilecek: LightGlobe.png -->
                                        <Image x:Name="LanguageIconDark"
                                           Source="pack://application:,,,/BIMQuantityManager;component/Icons/LightGlobe.png"
                                           Width="19" Height="17"
                                           Stretch="Uniform"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           Visibility="Visible"/>
                                        <!-- Light Mode'da gösterilecek: BlackGlobe.png -->
                                        <Image x:Name="LanguageIconLight"
                                           Source="pack://application:,,,/BIMQuantityManager;component/Icons/BlackGlobe.png"
                                           Width="19" Height="17"
                                           Stretch="Uniform"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           Visibility="Collapsed"/>
                                    </Grid>
                                </MenuItem.Icon>

                                <!-- 🇺🇸 ENGLISH -->
                                <MenuItem x:Name="EnglishMenuItem"
                                   Header="English"
                                   Click="LanguageMenuItem_Click"
                                   Tag="en-US"
                                   Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="🇺🇸" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>

                                <!-- 🇩🇪 DEUTSCH -->
                                <MenuItem x:Name="GermanMenuItem"
                                     Header="Deutsch"
                                     Click="LanguageMenuItem_Click"
                                     Tag="de-DE"
                                     Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="🇩🇪" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>

                                <!-- 🇷🇺 RUSSIAN -->
                                <MenuItem x:Name="RussianMenuItem"
                                     Header="Русский"
                                     Click="LanguageMenuItem_Click"
                                     Tag="ru-RU"
                                     Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="🇷🇺" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
            </Grid>
        </Border>

        <Border Grid.Row="1"
        Background="{DynamicResource CardBrush}"
        BorderBrush="{DynamicResource BorderBrush}"
        BorderThickness="0,0,0,1"
        Padding="20,16,20,14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Sol: ACTIVE VIEW SELECTION -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="ActiveViewLabel"
                       Text="Active View "
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       FontSize="14"
                       VerticalAlignment="Center"
                       Margin="21,0,10,0"/>

                    <ComboBox x:Name="ActiveViewComboBox"
                      Style="{StaticResource CustomComboBoxStyle}"
                      Background="Transparent"
                      Foreground="White"
                      ItemContainerStyle="{StaticResource CustomComboBoxItem}"
                      ItemsSource="{Binding AllViews}"
                      SelectedItem="{Binding ActiveView}"
                      DisplayMemberPath="DisplayName"
                      Width="300"
                      SelectionChanged="ActiveViewComboBox_SelectionChanged">
                        <ComboBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel/>
                            </ItemsPanelTemplate>
                        </ComboBox.ItemsPanel>
                    </ComboBox>
                </StackPanel>

                <!-- Sağ: SELECTED VIEWS -->
                <StackPanel Grid.Column="2" 
                    Orientation="Horizontal" 
                    VerticalAlignment="Center"
                    HorizontalAlignment="Right"
                    Margin="0,0,20,0">
                    <TextBlock x:Name="SelectedViewsLabel"
                       Text="Selected Views:"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       FontSize="14"
                       VerticalAlignment="Center"
                       Margin="0,0,10,0"/>

                    <ComboBox x:Name="ViewComboBox"
                      Background="{DynamicResource CardBrush}"
                      Foreground="{DynamicResource TextPrimaryBrush}"
                      BorderBrush="{DynamicResource BorderBrush}"
                      BorderThickness="1"
                      Width="300"
                      Height="35">

                        <ComboBox.Template>
                            <ControlTemplate TargetType="ComboBox">
                                <Grid>
                                    <ToggleButton x:Name="ToggleButton"
                                          Grid.Column="2"
                                          Focusable="false"
                                          IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"
                                          Background="{DynamicResource CardBrush}"
                                          BorderBrush="{DynamicResource BorderBrush}"
                                          BorderThickness="1"
                                          Cursor="Hand">
                                        <ToggleButton.Style>
                                            <Style TargetType="ToggleButton">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ToggleButton">
                                                            <Border x:Name="Border"
                                                            Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="4">
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition/>
                                                                        <ColumnDefinition Width="32"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <!-- Selected count display -->
                                                                    <TextBlock Grid.Column="0"
                                                                       VerticalAlignment="Center"
                                                                       Margin="12,0,0,0">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                                                                <Setter Property="FontSize" Value="12"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding DataContext.SelectedViews.Count, RelativeSource={RelativeSource AncestorType=Window}}" Value="0">
                                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                <Run Text="{Binding DataContext.SelectedViews.Count, Mode=OneWay, RelativeSource={RelativeSource AncestorType=Window}, StringFormat='{}{0}'}" 
                                                                     FontWeight="SemiBold"/>
                                                                <Run Text=" view(s) selected" 
                                                                     FontWeight="Normal"/>
                                                                    </TextBlock>

                                                                    <!-- Placeholder when empty -->
                                                                    <TextBlock Grid.Column="0"
                                                                       x:Name="SelectViewsPlaceholder"
                                                                       Text="Select views..."
                                                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                                                       Opacity="0.5"
                                                                       FontStyle="Italic"
                                                                       FontSize="12"
                                                                       VerticalAlignment="Center"
                                                                       Margin="12,0,0,0"
                                                                       IsHitTestVisible="False">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding DataContext.SelectedViews.Count, RelativeSource={RelativeSource AncestorType=Window}}" Value="0">
                                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>

                                                                    <!-- Modern Arrow Icon -->
                                                                    <Border Grid.Column="1"
                                                                    Background="Transparent"
                                                                    Padding="8">
                                                                        <Path x:Name="ArrowPath"
                                                                      HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"
                                                                      Data="M 0 0 L 5 5 L 10 0"
                                                                      Stroke="{DynamicResource TextPrimaryBrush}"
                                                                      StrokeThickness="2"
                                                                      StrokeLineJoin="Round"
                                                                      StrokeStartLineCap="Round"
                                                                      StrokeEndLineCap="Round">
                                                                            <Path.RenderTransform>
                                                                                <RotateTransform x:Name="ArrowRotation" Angle="0" CenterX="5" CenterY="2.5"/>
                                                                            </Path.RenderTransform>
                                                                        </Path>
                                                                    </Border>
                                                                </Grid>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource ComboItemSelectedBrush}"/>
                                                                </Trigger>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Trigger.EnterActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation Storyboard.TargetName="ArrowRotation"
                                                                                         Storyboard.TargetProperty="Angle"
                                                                                         To="180"
                                                                                         Duration="0:0:0.2"/>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </Trigger.EnterActions>
                                                                    <Trigger.ExitActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation Storyboard.TargetName="ArrowRotation"
                                                                                         Storyboard.TargetProperty="Angle"
                                                                                         To="0"
                                                                                         Duration="0:0:0.2"/>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </Trigger.ExitActions>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>

                                    <!-- Modern Popup -->
                                    <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide"
                                   StaysOpen="False">
                                        <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="280">
                                            <Border x:Name="DropDownBorder"
                                            Background="{DynamicResource ComboBackgroundBrush}"
                                            BorderBrush="{DynamicResource ComboBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Margin="0,2,0,0">
                                                <Border.Effect>
                                                    <DropShadowEffect Color="Black" 
                                                              Opacity="0.3" 
                                                              BlurRadius="16" 
                                                              ShadowDepth="4"
                                                              Direction="270"/>
                                                </Border.Effect>
                                                <ScrollViewer Margin="2,4,2,4" 
                                                      SnapsToDevicePixels="True"
                                                      VerticalScrollBarVisibility="Auto">
                                                    <ItemsControl ItemsSource="{Binding DataContext.AvailableViews, RelativeSource={RelativeSource AncestorType=Window}}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <CheckBox Content="{Binding DisplayName}"
                                                                  Foreground="{DynamicResource ComboForegroundBrush}"
                                                                  Margin="2,1"
                                                                  FontSize="12"
                                                                  Cursor="Hand"
                                                                  Click="ViewCheckBox_Click">
                                                                    <CheckBox.Style>
                                                                        <Style TargetType="CheckBox">
                                                                            <Setter Property="Template">
                                                                                <Setter.Value>
                                                                                    <ControlTemplate TargetType="CheckBox">
                                                                                        <Border x:Name="MainBorder"
                                                                                        Background="Transparent"
                                                                                        Padding="8,5"
                                                                                        CornerRadius="4">
                                                                                            <Grid>
                                                                                                <Grid.ColumnDefinitions>
                                                                                                    <ColumnDefinition Width="Auto"/>
                                                                                                    <ColumnDefinition Width="*"/>
                                                                                                </Grid.ColumnDefinitions>

                                                                                                <!-- Modern CheckBox -->
                                                                                                <Border Grid.Column="0"
                                                                                                x:Name="CheckBoxBorder"
                                                                                                Width="16"
                                                                                                Height="16"
                                                                                                BorderBrush="{DynamicResource BorderBrush}"
                                                                                                BorderThickness="1.5"
                                                                                                CornerRadius="3"
                                                                                                Background="Transparent"
                                                                                                Margin="0,0,8,0">
                                                                                                    <Path x:Name="CheckMark"
                                                                                                  Data="M 2,7 L 5,10 L 12,2"
                                                                                                  Stroke="White"
                                                                                                  StrokeThickness="2"
                                                                                                  StrokeLineJoin="Round"
                                                                                                  StrokeStartLineCap="Round"
                                                                                                  StrokeEndLineCap="Round"
                                                                                                  Visibility="Collapsed"
                                                                                                  Margin="0"/>
                                                                                                </Border>

                                                                                                <!-- Text -->
                                                                                                <ContentPresenter Grid.Column="1"
                                                                                                          VerticalAlignment="Center"
                                                                                                          HorizontalAlignment="Left"/>
                                                                                            </Grid>
                                                                                        </Border>
                                                                                        <ControlTemplate.Triggers>
                                                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                                                <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource ComboItemHoverBrush}"/>
                                                                                            </Trigger>
                                                                                            <Trigger Property="IsChecked" Value="True">
                                                                                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                                                                                <Setter TargetName="CheckBoxBorder" Property="Background" Value="{DynamicResource ComboItemSelectedBrush}"/>
                                                                                                <Setter TargetName="CheckBoxBorder" Property="BorderBrush" Value="{DynamicResource ComboItemSelectedBrush}"/>
                                                                                            </Trigger>
                                                                                        </ControlTemplate.Triggers>
                                                                                    </ControlTemplate>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </Style>
                                                                    </CheckBox.Style>
                                                                </CheckBox>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </ScrollViewer>
                                            </Border>
                                        </Grid>
                                    </Popup>
                                </Grid>
                            </ControlTemplate>
                        </ComboBox.Template>
                    </ComboBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Search Box Section - Row 2 -->
        <Border Grid.Row="2"
        Background="{DynamicResource CardBrush}"
        BorderBrush="{DynamicResource BorderBrush}"
        BorderThickness="0,0,0,1"
        Padding="20,12,20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="SearchLabel"
                       Text="Search Category / Type:"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       FontSize="14"
                       VerticalAlignment="Center"
                       Margin="21,0,10,0"/>

                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     FontSize="14"
                     Padding="8,6"
                     Width="289"
                     VerticalAlignment="Center"
                     Background="Transparent"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     BorderBrush="{DynamicResource BorderBrush}"
                     BorderThickness="1">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TextBox">
                                            <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4">
                                                <Grid>
                                                    <ScrollViewer x:Name="PART_ContentHost" Margin="2"/>
                                                    <TextBlock x:Name="SearchPlaceholder"
                                                       Text="e.g., Walls, Doors, Windows..."
                                                       Foreground="#999999"
                                                       Margin="10,6,0,0"
                                                       IsHitTestVisible="False"
                                                       FontStyle="Italic">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- DataGrid Section - Grid.Row="3" -->
        <Border Grid.Row="3"
        Margin="20,20,20,16"
        Background="{DynamicResource CardBrush}"
        BorderBrush="{DynamicResource BorderBrush}"
        BorderThickness="1"
        CornerRadius="8">

            <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                  VerticalScrollBarVisibility="Auto">

                <DataGrid x:Name="TypeDataGrid"
                  ItemsSource="{Binding TypeData}"
                  Style="{StaticResource ModernDataGrid}"
                  AlternationCount="2"
                  HeadersVisibility="Column"
                  AutoGenerateColumns="False"
                  RowHeight="36"
                  GridLinesVisibility="None"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  IsReadOnly="True"
                  Background="{DynamicResource CardBrush}"
                  Foreground="{DynamicResource TextPrimaryBrush}" 
                  Margin="4,4,4,4" 
                  FontSize="14"
                  HorizontalScrollBarVisibility="Disabled"
                  VerticalScrollBarVisibility="Disabled"
                  EnableColumnVirtualization="False"
                  EnableRowVirtualization="True">

                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="FontFamily" Value="Segoe UI"/>
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="8,12"/>
                        </Style>

                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="{DynamicResource DataGridRowBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="AlternationIndex" Value="1">
                                    <Setter Property="Background" Value="{DynamicResource DataGridAlternateBrush}"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource DataGridAlternateBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>

                        <Style TargetType="DataGridCell">
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="8,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border Background="{TemplateBinding Background}"
                                        BorderBrush="Transparent"
                                        BorderThickness="0"
                                        Padding="{TemplateBinding Padding}"
                                        SnapsToDevicePixels="True">
                                            <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                      VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <DataGridTextColumn x:Name="CategoryColumn"
                                    Header="Category" 
                                    Binding="{Binding Category}" 
                                    Width="200">
                            <DataGridTextColumn.HeaderStyle>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="Padding" Value="13,0,8,12"/>
                                </Style>
                            </DataGridTextColumn.HeaderStyle>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="Medium"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="Padding" Value="8,0,0,0"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn x:Name="TypeNameColumn"
                                    Header="Type Name" 
                                    Binding="{Binding TypeName}" 
                                    Width="350">
                            <DataGridTextColumn.HeaderStyle>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="Padding" Value="13,0,8,12"/>
                                </Style>
                            </DataGridTextColumn.HeaderStyle>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="Padding" Value="8,0,0,0"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn x:Name="TotalQuantityColumn"
                                    Header="Total Quantity" 
                                    Binding="{Binding TotalQuantity}" 
                                    Width="150">
                            <DataGridTextColumn.HeaderStyle>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="13,0,8,12"/>
                                </Style>
                            </DataGridTextColumn.HeaderStyle>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Binding="{Binding ActiveViewQuantity}" 
                                    Width="200">
                            <DataGridTextColumn.HeaderTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DataContext.ActiveViewColumnHeader, RelativeSource={RelativeSource AncestorType=DataGrid}}" 
                                       FontWeight="SemiBold"
                                       FontSize="14"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap"
                                       Padding="13,0,8,12"/>
                                </DataTemplate>
                            </DataGridTextColumn.HeaderTemplate>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </ScrollViewer>
        </Border>

        <!-- Bottom Panel - Export Button with Context Menu -->
        <Border Grid.Row="4"
             Background="{DynamicResource CardBrush}"
             BorderBrush="{DynamicResource BorderBrush}"
             BorderThickness="0,1,0,0"
             Padding="20,14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Export Button with Dropdown -->
                <Button Grid.Column="2"
                     x:Name="ExportButton"
                     Content="Export ▾"
                     Style="{StaticResource ModernButton}"
                     Padding="24,10"
                     FontSize="14"
                     HorizontalAlignment="Right"
                     VerticalAlignment="Center"
                     Click="Export_Click">

                    <Button.ContextMenu>
                        <ContextMenu x:Name="ExportContextMenu"
                             Style="{StaticResource ModernContextMenuStyle}"
                             Placement="Bottom"
                             PlacementTarget="{Binding ElementName=ExportButton}"
                             VerticalOffset="2"
                             HorizontalOffset="0"
                             MinWidth="220">

                            <!-- Excel -->
                            <MenuItem x:Name="ExcelMenuItem"
                                 Header="Export to Excel" 
                                 Style="{StaticResource ModernMenuItemStyle}">
                                <MenuItem.Icon>
                                    <Grid Width="16" Height="16">
                                        <Rectangle Fill="#217346" RadiusX="2" RadiusY="2"/>
                                        <Path Data="M4,6 L7,10 L4,14 M8,6 L11,10 L8,14" 
                                             Stroke="White" 
                                             StrokeThickness="1.5" 
                                             StrokeLineJoin="Round"/>
                                    </Grid>
                                </MenuItem.Icon>

                                <MenuItem x:Name="ExcelOnlyTableItem"
                          Header="Only Table" 
                          Click="ExportToExcel_Click"
                          Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <Grid Width="16" Height="16">
                                            <Rectangle Fill="#217346" RadiusX="2" RadiusY="2"/>
                                            <Path Data="M3,5 L13,5 M3,8 L13,8 M3,11 L13,11" 
                                  Stroke="White" 
                                  StrokeThickness="1.5"/>
                                        </Grid>
                                    </MenuItem.Icon>
                                </MenuItem>

                                <MenuItem x:Name="ExcelPieChartItem"
                          Header="With Pie Chart" 
                          Click="ExportToPieChart_Click"
                          Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <Grid Width="16" Height="16">
                                            <Rectangle Fill="#217346" RadiusX="2" RadiusY="2"/>
                                            <Path Data="M8,3 L8,8 L13,8 A5,5 0 1,1 8,3 Z" 
                                  Fill="White"/>
                                        </Grid>
                                    </MenuItem.Icon>
                                </MenuItem>

                                <MenuItem x:Name="ExcelLineChartItem"
                          Header="With Line Chart" 
                          Click="ExportToLineChart_Click"
                          Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <Grid Width="16" Height="16">
                                            <Rectangle Fill="#217346" RadiusX="2" RadiusY="2"/>
                                            <Path Data="M2,13 L5,8 L9,10 L14,3" 
                                  Stroke="White" 
                                  StrokeThickness="1.5"
                                  StrokeLineJoin="Round"/>
                                        </Grid>
                                    </MenuItem.Icon>
                                </MenuItem>

                                <MenuItem x:Name="ExcelBarChartItem"
                          Header="With Bar Chart" 
                          Click="ExportToBarChart_Click"
                          Style="{StaticResource ModernMenuItemStyle}">
                                    <MenuItem.Icon>
                                        <Grid Width="16" Height="16">
                                            <Rectangle Fill="#217346" RadiusX="2" RadiusY="2"/>
                                            <Path Data="M3,13 L3,8 L6,8 L6,13 M7,13 L7,5 L10,5 L10,13 M11,13 L11,10 L14,10 L14,13" 
                                  Fill="White"/>
                                        </Grid>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </MenuItem>

                            <!-- PDF -->
                            <MenuItem x:Name="PdfMenuItem"
                      Header="Export to Pdf"
                      Click="ExportToPdf_Click"
                      Style="{StaticResource ModernMenuItemStyle}">
                                <MenuItem.Icon>
                                    <Grid Width="16" Height="16">
                                        <Rectangle Fill="#DC3545" RadiusX="2" RadiusY="2"/>
                                        <TextBlock Text="PDF"
                                   FontSize="6"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </MenuItem.Icon>
                            </MenuItem>

                            <!-- Word -->
                            <MenuItem x:Name="WordMenuItem"
                      Header="Export to Word" 
                      Click="ExportToWord_Click"
                      Style="{StaticResource ModernMenuItemStyle}">
                                <MenuItem.Icon>
                                    <Grid Width="16" Height="16">
                                        <Rectangle Fill="#2B579A" RadiusX="2" RadiusY="2"/>
                                        <Path Data="M5,4 L6,12 L8,12 L9,7 L10,12 L12,12 L13,4"
                              Stroke="White" 
                              StrokeThickness="1.5" 
                              StrokeLineJoin="Round"/>
                                    </Grid>
                                </MenuItem.Icon>
                            </MenuItem>

                            <!-- CSV -->
                            <MenuItem x:Name="CsvMenuItem"
                      Header="Export to CSV" 
                      Click="ExportToCsv_Click"
                      Style="{StaticResource ModernMenuItemStyle}">
                                <MenuItem.Icon>
                                    <Grid Width="16" Height="16">
                                        <Rectangle Fill="#28A745" RadiusX="2" RadiusY="2"/>
                                        <Path Data="M3,5 L13,5 M3,8 L13,8 M3,11 L13,11" 
                              Stroke="White" 
                              StrokeThickness="1.5"/>
                                    </Grid>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>